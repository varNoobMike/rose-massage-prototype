$(document).ready(function () {
    // Open blog categories dropdown
    $(".rf-dropdown-button").click(function () {
        $(".rf-dropdown-item-wrap").toggleClass("open");
        $(".rf-dropdown-wrap").toggleClass("selected-open");
        $(".rf-dropdown-button").toggleClass("selected-open-btn");
        $(".open-icon-wrap").toggleClass("open-icon");
        $(".rf-dropdown-button").toggleClass("rotate");
    });

    // Close address list when click out of it
    $(document).on("click touchstart", function (event) {
        if ($(event.target).has(".rf-dropdown-item-wrap.open").length) {
            $(".rf-dropdown-item-wrap.open").removeClass("open");
            $(".rf-dropdown-wrap").removeClass("selected-open");
            $(".rf-dropdown-button").removeClass("selected-open-btn");
            $(".open-icon-wrap").removeClass("open-icon");
            $(".rf-dropdown-button").removeClass("rotate");
        }
    });

    $(".rf-search-icon").on("click", function (e) {
        e.preventDefault();
        var formval = $("#blog_search_form input#s")
                .val()
                .trim();
        if (formval && formval !== $("#blog_search_form input#s").data("prev")) {
            $("#blog_search_form").submit();
        }
    });

    $(".rf-search-icon").each(function () {
        $(this).on("click", function (e) {
            e.preventDefault();
            var formval = $("#blog_search_form_mob input#s")
                    .val()
                    .trim();
            if (formval && formval !== $("#blog_search_form input#s").data("prev")) {
                $("#blog_search_form_mob").submit();
            }
        })
    })


    $("#blog_search_form").keypress(function (e) {
        if (event.which === 13) {
            e.preventDefault();
            var formval = $("#blog_search_form input#s")
                    .val()
                    .trim();
            if (formval && formval !== $("#blog_search_form input#s").data("prev")) {
                $("#blog_search_form").submit();
            }
        }
    });

    // mobile enter search
    $("#blog_search_form_mob").keypress(function (e) {
        if (event.which === 13) {
            e.preventDefault();
            var formval = $("#blog_search_form_mob input#s")
                    .val()
                    .trim();
            if (
                    formval &&
                    formval !== $("#blog_search_form_mob input#s").data("prev")
                    ) {
                $("#blog_search_form_mob").submit();
            }
        }
    });

    $(".rf-blog-search-mobile").click(function () {
        $(".rf-blog-search-overlay").addClass("rf-open");
        $(".rf-blog-mobile-search-wrap").addClass("rf-open");
        $("body").addClass("scroll-off");
    });

    function closeMobileSearch() {
        $(".rf-blog-search-overlay").removeClass("rf-open");
        $(".rf-blog-mobile-search-wrap").removeClass("rf-open");
        $("body").removeClass("scroll-off");
    }

    $(".close-icon").click(function () {
        closeMobileSearch();
    });

    $(".rf-mob-search-form").submit(function () {
        $(".rf-mob-search-form .rf-search-icon").addClass("hide");
        $(".rf-btn-loader").addClass("show");
    });

    $(document).on("click", function (event) {
        if (event.target.classList.contains("rf-blog-search-overlay")) {
            closeMobileSearch();
        }
    });

    function removeEmptyItemsFromArray(arr) {
        var _arr = [];
        if (arr && arr.length > 0) {
            _arr = arr.filter(function (item) {
                return !(item === undefined || item === null || item === "");
            });
        }
        return _arr;
    }

    function decodeAndSplitQs(queryString) {
        var pos = queryString ? queryString.indexOf("?") : -1;
        return decodeURIComponent(
                pos > -1 ? queryString.substr(pos + 1) : queryString
                ).split("&");
    }

    function getHostAndPath() {

      

        if (window.location.href.indexOf("?") > -1) {
            
            return window.location.href.replace(/\page\/([0-9])/i, '').split("?")[0];
        }
          return window.location.href.replace(/\page\/([0-9])/i, '')
    }

    function addOrReplaceKeyFromString(key, value, queryString) {
        var _str = "";
        var queries = decodeAndSplitQs(queryString);
        if (queries.length > 0) {
            var parsed = removeEmptyItemsFromArray(queries).map(function (item) {
                if (item.indexOf(key) === -1) {
                    return item;
                }
                return;
            });
            if (value) {
                parsed.push(key + "=" + value);
            }
            var cleanArray = removeEmptyItemsFromArray(parsed);
            if (cleanArray.length > 0) {
                _str = "?" + cleanArray.join("&");
            }
        }
        return _str;
    }

    function removeKeyFromQueryString(key, queryString) {
        var _str = "";
        var queries = decodeAndSplitQs(queryString);
        if (queries.length > 0) {
            var clean = removeEmptyItemsFromArray(queries).filter(function (item) {
                return !(item.indexOf(key) > -1);
            });
            if (clean.length > 0) {
                _str = "?" + removeEmptyItemsFromArray(clean).join("&");
            }
        }
        return _str;
    }

    function removeKeyPageStringString(queryString) {

    }

    function addTagsURL(key, value) {
        var _queryString = window.location.search;

        var queryString = addOrReplaceKeyFromString(key, value, _queryString);
        var hostAndPath = getHostAndPath();
        window.location.href = hostAndPath + queryString;
    }

    $(".rf-dropdown-item-title").on("click", function () {
          window.location.href = $(this).data("url");
    });
});
